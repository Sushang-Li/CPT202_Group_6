<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mainStyle.css">
    <link href="https://fonts.googlefonts.cn/css?family=Roboto:400,500,700,900" rel="stylesheet">
    <script src="jquery-3.7.1.js"></script>
    <title>Welcome</title>
</head>

<body>
<div id="overlay"></div>
<div class="d-flex" id="wrapper">
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <a class="navbar-brand" href="#"></a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <!--menu 按钮-->
            <button class="btn btn-primary btn-position menu-toggle" id="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>

            <!-- navigation items -->
        </div>
        <a class="nav-link float-right" href="userHomepage.html">Homepage</a>
        <a class="nav-link float-right" href="userInformation.html">Information</a>
        <a class="nav-link float-right" href="userWallet.html">Wallet</a>
        <a class="nav-link float-right" href="userBooking.html">Booking</a>
        <a class="nav-link float-right" href="userStatistics.html">Statistics</a>
        <a class="nav-link float-right" href="userLogin.html">Sign In</a>
    </nav>


    <!-- Sidebar侧边栏 -->
    <div class="bg-light border-right" id="sidebar-wrapper">
        <div class="sidebar-heading">
            <!--关闭button-->
            <button class="btn btn-position" id="sidebar-close">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="list-group list-group-flush">
            <a href="userHomepage.html" class="list-group-item list-group-item-action bg-light">HOMEPAGE</a>
            <a href="userInformation.html" class="list-group-item list-group-item-action bg-light">INFORMATION</a>
            <a href="userWallet.html" class="list-group-item list-group-item-action bg-light">WALLET</a>
            <a href="userBooking.html" class="list-group-item list-group-item-action bg-light">BOOKING</a>
            <a href="userStatistics.html" class="list-group-item list-group-item-action bg-light">STATISTICS</a>
        </div>
    </div>


    <div id="page-content-wrapper">
            <!--页面内容-->

        <!--upcoming all bookings unpaid-->
        <div class="container-fluid">
            <ul class="nav nav-tabs justify-content-between">
                <li class="nav-item">
                    <a class="nav-link active" id="upcoming-tab"  href="#upcoming-tab">Upcoming</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="all-tab" href="#all-tab">All</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="unpaid-tab" href="#unpaid-tab">Unpaid</a>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab active" id="upcoming">
                <table class="table" id="upcoming-table">
                    <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>Sport Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Cancel</th>
                    </thead>
                    <tbody>
                    <tr>
                        <td id="booking-id"></td>
                        <td id="booking-name"></td>
                        <td id="booking-startTime"></td>
                        <td id="booking-endTime"></td>
                        <td id="booking-price"></td>
                        <td id="booking-status"></td>
                        <td id="booking-cancel"><button class="btn btn-danger">Cancel</button></td>
                    </tr>
                </table>

            </div>
            <div class="tab" id="all">
                <table class="table" id="all-table">
                    <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>Sport Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Price</th>
                        <th>Status</th>

                    </thead>
                    <tbody>
                    <tr>
                        <td id="booking-id2"></td>
                        <td id="booking-name2"></td>
                        <td id="booking-startTime2"></td>
                        <td id="booking-endTime2"></td>
                        <td id="booking-price2"></td>
                        <td id="booking-status2"></td>
                    </tr>
                </table>
            </div>
            <div class="tab" id="unpaid">
                <table class="table" id="unpaid-table">
                    <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>Sport Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Price</th>
                        <th>Status</th>

                    </thead>
                    <tbody>
                    <tr>
                        <td id="booking-id3"></td>
                        <td id="booking-name3"></td>
                        <td id="booking-startTime3"></td>
                        <td id="booking-endTime3"></td>
                        <td id="booking-price3"></td>
                        <td id="booking-status3"></td>
                    </tr>
                </table>
            </div>
        </div>


        </div>
    <!--<div class="container-fluid">




                <br>
                <br>



            </div>-->

    </div>
    <!-- /#page-content-wrapper -->

<!-- /#wrapper -->

<!--js-->

<script>
    $("#menu-toggle, #sidebar-close").click(function(e) {
        e.preventDefault();//阻止默认点击行为
        $("#wrapper").toggleClass("toggled");//控制侧边栏的显示与隐藏
        $("#sidebar-wrapper .list-group-item").toggleClass("hidden");//控制侧边栏的显示与隐藏
        $("#menu-toggle").toggleClass("hidden");//控制菜单按钮的显示与隐藏

        if ($("#wrapper").hasClass("toggled")) {
            $("#overlay").show();
        } else {
            $("#overlay").hide();
        }
    });

    // 取消按钮
    let cancelButtons = document.querySelectorAll('.btn-danger');
    cancelButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            // 显示确认对话框
            var isConfirmed = confirm('Are you sure you want to cancel?');
            if (isConfirmed) {
                // 获取要取消的预订的ID
                var bookingId = this.closest('tr').querySelector('th').innerText;
                console.log('Cancel booking with ID: ' + bookingId);
                // 发送DELETE请求到后端
                $.ajax({
                    url: '/api/bookings/' + bookingId,
                    type: 'DELETE',
                    success: function() {
                        console.log('Booking with ID ' + bookingId + ' is cancelled');
                        // 如果后端成功删除了预订，从前端删除这行
                        this.closest('tr').remove();
                    },
                        // 如果后端没有成功删除预订，显示错误消息
                    error: function() {
                        alert('Failed to cancel booking with ID ' + bookingId);
                    }
                });
            }
        });
    });




    window.onload = function () {

        fetch('http://localhost:8080/api/bookings', {
            method: "GET"
        })
            .then(response => response.json())
            .then(bookings => {
                var upcomingTable = document.querySelector('#upcoming-table tbody');
                upcomingTable.innerHTML = ''; // 清空表格

                bookings.forEach((booking) => {
                    if (booking.status === 'CONFIRMED') {
                        var row = document.createElement('tr');
                        row.innerHTML = `
                     <td id="booking-id-${booking.id}">${booking.id}</td>
                     <td id="booking-name-${booking.id}">${booking.name}</td>
                     <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
                     <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
                     <td id="booking-price-${booking.id}">${booking.price}</td>
                     <td id="booking-status-${booking.id}">${booking.status}</td>
                     <td id="booking-cancel-${booking.id}"><button class="btn btn-danger">Cancel</button></td>
            `;
                        upcomingTable.appendChild(row);
                    }
                });
            });
    };



/*upcoming all unpaid*/
    $(document).ready(function () {
        //当选项卡被点击时
        $('.nav-link').click(function () {
            //移除所有选项卡的active类
            $('.nav-link').removeClass('active');
            //给当前选项卡添加active类
            $(this).addClass('active');
            //获取当前选项卡的id
            var tabId = $(this).attr('id');
            //移除所有选项卡内容的active类
            $('.tab').removeClass('active');
            //给当前选项卡内容添加active类
            $('#' + tabId).addClass('active');
        });
    })

    $(document).ready(function() {
        // Handle the tab click event
        $('.nav-link').click(function() {
            // Get the id of the clicked tab
            var tabId = $(this).attr('id').replace('-tab', '');
            // Hide all tables
            $('.tab').hide();
            // Show the corresponding table
            $('#' + tabId).show();
        });
    });



</script>


</body>

</html>

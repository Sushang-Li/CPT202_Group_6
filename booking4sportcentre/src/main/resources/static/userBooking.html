<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mainStyle.css">
    <link href="https://fonts.googlefonts.cn/css?family=Roboto:400,500,700,900" rel="stylesheet">
    <script src="jquery-3.7.1.js"></script>
    <title>Welcome</title>
</head>

<body>
    <div id="overlay"></div>
    <div class="d-flex" id="wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <a class="navbar-brand" href="#"></a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!--menu 按钮-->
                <button class="btn btn-primary btn-position menu-toggle" id="menu-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                </button>

                <!-- navigation items -->
            </div>
            <a class="nav-link float-right" href="userHomepage.html" id="homepage-nav">Homepage</a>
            <a class="nav-link float-right" href="userInformation.html" id="information-nav">Information</a>
            <a class="nav-link float-right" href="userWallet.html" id="wallet-nav">Wallet</a>
            <a class="nav-link float-right" href="userBooking.html" id="booking-nav">Booking</a>
            <div class="logout">
                <a href="#" id="logout-nav">LOGOUT</a>

            </div>

            <a class="nav-link float-right" href="userLogin.html" id="temp6">Sign In</a>
        </nav>


        <!-- Sidebar侧边栏 -->
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">
                <!--关闭button-->
                <button class="btn btn-position" id="sidebar-close">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="list-group list-group-flush">
                <a href="userHomepage.html" class="list-group-item list-group-item-action bg-light"
                    id="homepage-nav2">HOMEPAGE</a>
                <a href="userInformation.html" class="list-group-item list-group-item-action bg-light"
                    id="information-nav2">INFORMATION</a>
                <a href="userWallet.html" class="list-group-item list-group-item-action bg-light"
                    id="wallet-nav2">WALLET</a>
                <a href="userBooking.html" class="list-group-item list-group-item-action bg-light"
                    id="booking-nav2">BOOKING</a>
                <a href="userStatistics.html" class="list-group-item list-group-item-action bg-light"
                    id="statistics-nav2">STATISTICS</a>
            </div>
        </div>


        <div id="page-content-wrapper">
            <!--页面内容-->

            <!--upcoming all bookings unpaid-->
            <div class="container-fluid">
                <ul class="nav nav-tabs justify-content-between">
                    <li class="nav-item">
                        <a class="nav-link active" id="upcoming-tab" href="#upcoming-tab">Upcoming</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="all-tab" href="#all-tab" onclick="showAll()">All</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="unpaid-tab" href="#unpaid-tab" onclick="showUnpaid()">Unpaid</a>
                    </li>
                </ul>
            </div>

            <div class="tab-content">
                <div class="tab active" id="upcoming">
                    <table class="table" id="upcoming-table">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Sport Name</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Cancel</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="booking-id"></td>
                                <td id="booking-name"></td>
                                <td id="booking-startTime"></td>
                                <td id="booking-endTime"></td>
                                <td id="booking-price"></td>
                                <td id="booking-status"></td>
                                <td id="booking-cancel"><button class="btn btn-danger">Cancel</button></td>
                                <td id="booking-cancel"><button class="btn btn-success">Pay</button></td>
                                <td id="booking-cancel"><button class="btn btn-warning">Delete</button></td>
                            </tr>
                    </table>

                </div>
                <div class="tab" id="all">
                    <table class="table" id="all-table">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Sport Name</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Price</th>
                                <th>Status</th>

                        </thead>
                        <tbody>
                            <tr>
                                <td id="booking-id2"></td>
                                <td id="booking-name2"></td>
                                <td id="booking-startTime2"></td>
                                <td id="booking-endTime2"></td>
                                <td id="booking-price2"></td>
                                <td id="booking-status2"></td>
                            </tr>
                    </table>
                </div>
                <div class="tab" id="unpaid">
                    <table class="table" id="unpaid-table">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Sport Name</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Price</th>
                                <th>Status</th>

                        </thead>
                        <tbody>
                            <tr>
                                <td id="booking-id3"></td>
                                <td id="booking-name3"></td>
                                <td id="booking-startTime3"></td>
                                <td id="booking-endTime3"></td>
                                <td id="booking-price3"></td>
                                <td id="booking-status3"></td>
                            </tr>
                    </table>
                </div>
            </div>


        </div>
        <!--<div class="container-fluid">




                <br>
                <br>



            </div>-->

    </div>
    <!-- /#page-content-wrapper -->

    <!-- /#wrapper -->

    <!--js-->

    <script>
        //复制自主页
        var urlParams = new URLSearchParams(window.location.search);
        var userId = urlParams.get('id');
        console.log(userId);

        // var userLink = document.getElementById('logo-nav');
        // userLink.href = "userHomepage.html?id=" + userId;

        var userLink = document.getElementById('homepage-nav');
        userLink.href = "userHomepage.html?id=" + userId;

        var userLink = document.getElementById('information-nav');
        userLink.href = "userInformation.html?id=" + userId;

        var userLink = document.getElementById('wallet-nav');
        userLink.href = "userWallet.html?id=" + userId;

        var userLink = document.getElementById('booking-nav');
        userLink.href = "userBooking.html?id=" + userId;

        // var userLink = document.getElementById('statistics-nav');
        // userLink.href = "userStatistics.html?id=" + userId;

        var userLink = document.getElementById('homepage-nav2');
        userLink.href = "userHomepage.html?id=" + userId;

        var userLink = document.getElementById('information-nav2');
        userLink.href = "userInformation.html?id=" + userId;

        var userLink = document.getElementById('wallet-nav2');
        userLink.href = "userWallet.html?id=" + userId;

        var userLink = document.getElementById('booking-nav2');
        userLink.href = "userBooking.html?id=" + userId;

        var userLink = document.getElementById('statistics-nav2');
        userLink.href = "userStatistics.html?id=" + userId;

    </script>
    <script>
        $("#menu-toggle, #sidebar-close").click(function (e) {
            e.preventDefault();//阻止默认点击行为
            $("#wrapper").toggleClass("toggled");//控制侧边栏的显示与隐藏
            $("#sidebar-wrapper .list-group-item").toggleClass("hidden");//控制侧边栏的显示与隐藏
            $("#menu-toggle").toggleClass("hidden");//控制菜单按钮的显示与隐藏

            if ($("#wrapper").hasClass("toggled")) {
                $("#overlay").show();
            } else {
                $("#overlay").hide();
            }
        });
        function cancelBooking(bookingId) {
            var isConfirmed = confirm('Are you sure you want to cancel?');
            if (isConfirmed) {
                var table = document.querySelector('#upcoming-table'); // 获取表格元素
                var rows = table.querySelectorAll('tr'); // 获取所有行元素

                rows.forEach(row => {
                    console.log(row);
                    var userIdCell = row.querySelector('td:first-child'); // 获取每行中第一列的用户ID单元格
                    console.log(userIdCell);
                    if (userIdCell !== null) {// 检查当前行的用户ID是否匹配指定的用户ID
                        fetch('http://localhost:8080/api/bookings/'+ bookingId, {
                            method: "DELETE"
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('网络请求失败');
                                }
                                return response.json();
                            })
                            .then(data => {
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('发生错误:', error);
                            });

                    }
                });
            }
        }



        window.onload = function () {

            fetch('http://localhost:8080/api/bookings', {
                method: "GET"
            })
                .then(response => response.json())
                .then(bookings => {
                    var upcomingTable = document.querySelector('#upcoming-table tbody');
                    upcomingTable.innerHTML = ''; // 清空表格

                    bookings.forEach((booking) => {
                        if (booking.status === 'CONFIRMED') {
                            var row = document.createElement('tr');
                            row.innerHTML = `
                     <td id="booking-id-${booking.id}">${booking.id}</td>
                     <td id="booking-name-${booking.id}">${booking.actName}</td>
                     <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
                     <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
                     <td id="booking-price-${booking.id}">${booking.price}</td>
                     <td id="booking-status-${booking.id}">${booking.status}</td>
                     <td id="booking-cancel-${booking.id}"><button class="btn btn-danger" onclick="cancelBooking(${booking.id})">Cancel</button></td>
            `;
                            upcomingTable.appendChild(row);
                        }
                    });
                });

        };



        function showAll() {

            fetch('http://localhost:8080/api/bookings', {
                //method: "GET"
            })
                .then(response => response.json())
                .then(bookings => {
                    var allTable = document.querySelector('#all-table tbody');
                    allTable.innerHTML = ''; // 清空表格

                    bookings.forEach((booking) => {
                        if (booking.status === 'CANCELLED') {
                            var row = document.createElement('tr');
                            row.innerHTML = `
            <td id="booking-id-${booking.id}">${booking.id}</td>
             <td id="booking-name-${booking.id}">${booking.actName}</td>
             <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
             <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
             <td id="booking-price-${booking.id}">${booking.price}</td>
            <td id="booking-status-${booking.id}">${booking.status}</td>
            <td id="booking-cancel-${booking.id}"><button class="btn btn-warning" onclick="cancelBooking(${booking.id})">Delete</button></td>`
                        } else if (booking.status === 'PENDING') {
                            var row = document.createElement('tr');
                            row.innerHTML = `
            <td id="booking-id-${booking.id}">${booking.id}</td>
             <td id="booking-name-${booking.id}">${booking.actName}</td>
             <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
             <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
             <td id="booking-price-${booking.id}">${booking.price}</td>
            <td id="booking-status-${booking.id}">${booking.status}</td>
            <td id="booking-cancel-${booking.id}"><button class="btn btn-success">Pay</button></td>
            `;
                        } else {
                            var row = document.createElement('tr');
                            row.innerHTML = `
                     <td id="booking-id-${booking.id}">${booking.id}</td>
                     <td id="booking-name-${booking.id}">${booking.actName}</td>
                     <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
                     <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
                     <td id="booking-price-${booking.id}">${booking.price}</td>
                     <td id="booking-status-${booking.id}">${booking.status}</td>
                     <td id="booking-cancel-${booking.id}"><button class="btn btn-danger" onclick="cancelBooking(${booking.id})">Cancel</button></td>
            `;

                        }

                        allTable.appendChild(row);
                    });
                });
        };


        function showUnpaid() {

            fetch('http://localhost:8080/api/bookings', {
                //method: "GET"
            })
                .then(response => response.json())
                .then(bookings => {
                    var unpaidTable = document.querySelector('#unpaid-table tbody');
                    unpaidTable.innerHTML = ''; // 清空表格

                    bookings.forEach((booking) => {
                        if (booking.status === 'PENDING') {
                            var row = document.createElement('tr');
                            row.innerHTML = `
            <td id="booking-id-${booking.id}">${booking.id}</td>
            <td id="booking-name-${booking.id}">${booking.actName}</td>
            <td id="booking-startTime-${booking.id}">${booking.startTime}</td>
            <td id="booking-endTime-${booking.id}">${booking.endTime}</td>
            <td id="booking-price-${booking.id}">${booking.price}</td>
            <td id="booking-status-${booking.id}">${booking.status}</td>
            <td id="booking-cancel-${booking.id}"><button class="btn btn-success">Pay</button></td>
`;
                            unpaidTable.appendChild(row);
                        }
                    });
                });
        };




        /*upcoming all unpaid*/
        $(document).ready(function () {
            //当选项卡被点击时
            $('.nav-link').click(function () {
                //移除所有选项卡的active类
                $('.nav-link').removeClass('active');
                //给当前选项卡添加active类
                $(this).addClass('active');
                //获取当前选项卡的id
                var tabId = $(this).attr('id');
                //移除所有选项卡内容的active类
                $('.tab').removeClass('active');
                //给当前选项卡内容添加active类
                $('#' + tabId).addClass('active');
            });
        })

        $(document).ready(function () {
            // Handle the tab click event
            $('.nav-link').click(function () {
                // Get the id of the clicked tab
                var tabId = $(this).attr('id').replace('-tab', '');
                // Hide all tables
                $('.tab').hide();
                // Show the corresponding table
                $('#' + tabId).show();
            });
        });



    </script>


</body>
<script type="text/javascript" src="logout.js"></script>


</html>